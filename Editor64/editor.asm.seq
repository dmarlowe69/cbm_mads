;*********************************;;         EDITOR6464;      EDITOR.C64 V072882; EDITOR FOR ASSEMBLER SOURCE FILES;       BASIC V2 EXTENSION; (C) 1982 BY COMMODORE MACHINES;;  DOCUMENTED BY DENTON MARLOWE;********************************; EXTERNAL ADDRESS EQUATES;********************************; ZERO PAGE;********************************TEMP0 = $0022TEMP1 = $0023TEMP2 = $0024TEMP3 = $0025OLDLIN = $003BINPPTR = $0043CHRMOD = $008AFNADR  = $00BB ;POINTER TO FILENAMESTACK = $0100;********************************; BASIC EQUATES;********************************BASBUF=$0200READY=$A474MAINE=$A52ALINKPG=$A533FNDLIN=$A613CLRENT=$A659LINGET=$A96BPRINTE=$AAD7ANDORE=$AEFDSGNENT=$BC49LINPRT=$BDCDFOUT=$BDDD;********************************; KERNAL EQUATES;********************************LSVPAR=$E1E6CKCOMA=$E20ESETLFS=$FFBASETNAM=$FFBDOPEN=$FFC0CLOSE=$FFC3CHKIN=$FFC6CHKOUT=$FFC9CLRCHN=$FFCCCHRIN=$FFCFCHROUT=$FFD2GETIN=$FFE4SETTMO=$FFA2;********************************; EDITOR64 ENTRY POINT;********************************EDITOR LDA #$00     ;NULL       STA OLDLIN   ;$3B       STA OLDLIN+1 ;$3C       LDX #$00     ;ZERO OFFSET INTO TEXT       JSR PRTXT    ;PRINT STARTUP MESSAGE;********************************; MODIFIY END OF CHRGET ROUTINE; TO POINT TO EDITOR64 HANDLER; AND ON KILL RESET;********************************       ;LDA #$4C      ;'L'       ;BIT $60A9XXCC0B .BYTE $A9 ; LDA #$4CXXCC0C .BYTE $4CXXCC0D .BYTE $2CKILL   .BYTE $A9 ; LDA #$60XXCC0F .BYTE $60;       STA CHRMOD       LDA #<XXC02C ;#$2C       STA CHRMOD+1       LDA #>XXC02C ;$C0       STA CHRMOD+2       JMP XXC329;********************************XXC01D STA XXC641       PHP        PLA        STA XXC642       STX XXC643       STY XXC644       RTS ;********************************XXC02C JSR XXC01D       TSX        LDA STACK+1,X       CMP #$8C       BNE XXC03E       LDA STACK+2,X       CMP #$A4       BEQ XXC04DXXC03E LDY XXC644       LDX XXC643       LDA XXC642       PHA        LDA XXC641       PLP        RTS ;********************************XXC04D LDA XXC642       LSR A       BCC XXC0A0       LDX #$00       STX XXC63F       DEX        INX XXC05A LDY $7AXXC05C LDA BASBUF,Y       SEC        SBC CMDTAB,X       BEQ XXC079       CMP #$80       BEQ XXC07D       INC XXC63FXXC06C INX        LDA CMDTAB-1,X       BPL XXC06C       LDA CMDTAB,X       BNE XXC05A       BEQ XXC03EXXC079 INX        INY        BNE XXC05CXXC07D STY $7A       LDA XXC63F       ASL A       TAX        LDA VECTOR+1,X       PHA        LDA VECTOR,X       PHA        JSR XXC03E       JMP $0073;********************************AUTO   JSR LINGET       LDA $14       STA OLDLIN       LDA $15       STA OLDLIN+1       JMP XXC329;********************************XXC0A0 PLA        PLA        JSR XXC03E       JSR LINGET       BEQ XXC0E1       LDA OLDLIN       ORA OLDLIN+1       BEQ XXC0E1       LDA $14       CLC        ADC OLDLIN       STA $63       LDA $15       ADC OLDLIN+1       STA $62       LDX #$90       SEC        JSR SGNENT       JSR FOUT       LDX #$00       LDA #$20      ;' '       STA $0277,X       INX XXC0CE LDA $0100,X       BEQ XXC0D9       STA $0277,X       INX        BNE XXC0CEXXC0D9 LDA #$20      ;' '       STA $0277,X       INX        STX $C6XXC0E1 JSR XXC20B       JMP $A4A2;********************************NUMBER BEQ XXC12B       JSR LINGET       JSR FNDLIN       JSR ANDORE       JSR LINGET       LDA $14       STA FNADR       LDA $15       STA FNADR+1       JSR ANDORE       JSR LINGETXXC103 JSR XXC2CA       BEQ XXC128       JSR XXC2C0       CLC        LDA FNADR       JSR XXC2BC       ADC $14       STA FNADR       LDA FNADR+1       JSR XXC2BC       ADC $15       STA FNADR+1XXC11E JSR XXC2CA       BNE XXC11E       JSR XXC2C0       BNE XXC103XXC128 JMP XXC329;********************************XXC12B JSR PRINTE       JSR XXC2D2       LDA #$E8       STA FNADR       LDA #$03       STA FNADR+1       LDA #$0A       STA $14       LDA #$00       STA $15       JMP XXC103;********************************GET    JSR XXC29A       JSR CHKIN       LDA $90       BEQ XXC151       JMP XXC594;********************************XXC151 LDA #$01       JSR XXC2B6XXC156 JSR CHRIN       CMP #$0D       BEQ XXC166       JSR XXC2BC       LDA $90       BNE XXC184       BEQ XXC156XXC166 JSR XXC19E       JSR XXC2CD       CMP #$01       BNE XXC178       JSR XXC19E       JSR XXC19B       BNE XXC180XXC178 JSR XXC2C0       LDA #$00       JSR XXC2BCXXC180 LDA $90       BEQ XXC151XXC184 TYA        JSR XXC2B6       LDA $5F       STA $2D       LDA $60       STA $2E       JSR CLRCHN       LDA #$08       JSR CLOSE       JMP XXC12B;********************************XXC19B JSR XXC19EXXC19E LDA $5F       BNE XXC1A4       DEC $60XXC1A4 DEC $5F       RTS ;********************************; PUT/CPUT ; SAVE A FILE OR PART OF A FILE; TO FLOPPY DISK;********************************CPUT   LDX #$00       ;BIT SETTMO       .BYTE $2CPUT    .BYTE $A2       .BYTE $FF       STX INDEX       JSR XXC24F       JSR CHKOUT       LDA $90       BEQ XXC1CB       JMP XXC594;********************************XXC1BC LDA #$0D       JSR CHROUT       LDA $90       BEQ XXC1C8       JMP XXC594;********************************XXC1C8 JSR XXC2C0XXC1CB JSR XXC2CA       BEQ XXC1D8       LDX INDEX       JSR XXC481       BCS XXC1E7XXC1D8 JSR CLRCHN       LDA #$08       JSR CLOSE       JMP XXC329;********************************XXC1E3 TYA        JSR CHROUTXXC1E7 JSR XXC2CA       TAY        BEQ XXC1BC       CMP #$20      ;' '       BNE XXC1F9       TXA        BMI XXC1E3       BNE XXC1E7       INX        BNE XXC1E3XXC1F9 CMP #OLDLIN      ;';'       BEQ XXC201       CMP #$27      ;'''       BNE XXC203XXC201 LDX #$FFXXC203 TXA        BMI XXC1E3       LDX INDEX       BEQ XXC1E3XXC20B LDX #$FF       LDY #$00XXC20F INX        LDA BASBUF,X       CMP #$20      ;' '       BEQ XXC20F;********************************       .BYTE $24;********************************XXC218 INX        LDA BASBUF,X       CMP #$30      ;'0'       BCC XXC224       CMP #$3A      ;':'       BCC XXC218XXC224 LDA BASBUF,X       CMP #$20      ;' '       BNE XXC22C       INX XXC22C LDA BASBUF,X       BEQ XXC23A       AND #$7F       STA BASBUF,Y       INX        INY        BNE XXC22CXXC23A STA BASBUF,Y       INY        INY        STA BASBUF,Y       INY        INY        INY        RTS ;********************************XXC246 LDX #$00       STX $90       STX $B7       JMP $E257;********************************; OPEN SOURCE FILE OF FLOPPY DISK;********************************XXC24F JSR XXC246       LDY #$00XXC254 LDA (FNADR),Y       STA ($2D),Y       INY        CPY $B7       BNE XXC254       LDX #$04XXC25F LDA INDEX,X       STA ($2D),Y       INY        DEX        BNE XXC25F       STY $B7       JSR $0079       BEQ XXC272       JSR CKCOMAXXC272 JSR XXC452XXC275 JSR LSVPAR       LDA #$08       TAY        LDX $BA       JSR SETLFS       LDA $B7       LDX $2D       LDY $2E       JSR SETNAM       JSR OPEN       LDA $90       BEQ XXC297       CMP #$40      ;'@'       BEQ XXC297       JMP XXC594;********************************XXC297 LDX #$08       RTS ;********************************XXC29A JSR XXC246       JSR $0079       BEQ XXC2A5       JSR CKCOMAXXC2A5 JSR LINGET       JSR FNDLIN       LDA FNADR       LDY FNADR+1       STA $2D       STY $2E       JMP XXC275;********************************XXC2B6 JSR XXC2B9XXC2B9 JSR XXC2BCXXC2BC LDY #$00       STA ($5F),YXXC2C0 INC $5F       BNE XXC2C6       INC $60XXC2C6 RTS ;********************************       JSR XXC2CAXXC2CA JSR XXC2C0XXC2CD LDY #$00       LDA ($5F),Y       RTS ;********************************XXC2D2 LDA $2B       STA $5F       LDA $2C       STA $60       RTS ;********************************XXC2DB JMP $AF08;********************************DELETE BEQ XXC2DB       JSR XXC452       LDA $5F       LDX $60       STA TEMP2       STX TEMP3       JSR FNDLIN       BCC XXC2FE       LDY #$01       LDA ($5F),Y       BEQ XXC2FE       TAX        DEY        LDA ($5F),Y       STA $5F       STX $60XXC2FE LDA TEMP2       SEC        SBC $5F       TAX        LDA TEMP3       SBC $60       TAY        BCS XXC329       TXA        CLC        ADC $2D       STA $2D       TYA        ADC $2E       STA $2E       LDY #$00XXC318 LDA ($5F),Y       STA (TEMP2),Y       INY        BNE XXC318       INC $60       INC TEMP3       LDA $2E       CMP TEMP3       BCS XXC318;********************************;;********************************XXC329 JSR LINKPG       LDA TEMP0       LDX TEMP1       CLC        ADC #$02       STA $2D       BCC XXC338       INX XXC338 STX $2E       JSR CLRENT       JMP READY;********************************CHANGE STA XXC63F       LDX #$00       STX $33       JSR XXC437       LDX #$02       STX $49       BNE XXC357FIND   STA XXC63F       LDX #$00       STX $49XXC357 JSR XXC437       JSR $0073       BEQ XXC362       JSR ANDOREXXC362 JSR XXC452       JSR PRINTE       BNE XXC375XXC36A INY        TYA        CLC        ADC $5F       STA $5F       BCC XXC375       INC $60XXC375 JSR XXC2CA       BEQ XXC37F       JSR XXC481       BCS XXC382XXC37F JMP MAINE;********************************XXC382 STY XXC640XXC385 INC XXC640       LDY XXC640       LDX $31       LDA $32       STA XXC641XXC392 LDA ($5F),Y       BEQ XXC36A       CMP BASBUF,X       BNE XXC385       INX        INY        DEC XXC641       BNE XXC392       DEY        STY XXC63F       STY XXC643       LDA $49       BEQ XXC413       JSR XXC495       LDA $34       SEC        SBC $32       STA XXC642       BEQ XXC3E7XXC3BA INY        BEQ XXC37F       LDA ($5F),Y       BNE XXC3BA       CLC        TYA        ADC XXC642       CMP #$02       BCC XXC413       CMP #$4B      ;'K'       BCS XXC413       LDA XXC642       BPL XXC3D6       DEC XXC641XXC3D6 CLC        ADC XXC63F       STA XXC643       BCS XXC3E4       JSR XXC4CB       BEQ XXC3E7XXC3E4 JSR XXC4B1XXC3E7 LDA XXC643       SEC        SBC $34       TAY        INY        LDA $34       BEQ XXC404       STA XXC644       LDX $33XXC3F8 LDA BASBUF,X       STA ($5F),Y       INX        INY        DEC XXC644       BNE XXC3F8XXC404 CLC        LDA $2D       ADC XXC642       STA $2D       LDA $2E       ADC XXC641       STA $2EXXC413 LDX INPPTR       LDA INPPTR+1       JSR LINPRT       LDY #$00       LDA #$20      ;' 'XXC41E JSR CHROUT       INY        BNE XXC427       JMP MAINE;********************************XXC427 LDA ($5F),Y       BNE XXC41E       JSR PRINTE       JSR XXC55A       LDY XXC643       JMP XXC382;********************************XXC437 LDY $7A       INY        STY $31,X       LDA #$00       STA $32,XXXC440 LDA BASBUF,Y       BEQ XXC45A       CMP XXC63F       BEQ XXC44F       INC $32,X       INY        BNE XXC440XXC44F STY $7A       RTS ;********************************XXC452 BCC XXC45D       BEQ XXC45D       CMP #$2D      ;'-'       BEQ XXC45DXXC45A JMP $AF08;********************************XXC45D JSR LINGET       JSR FNDLIN       JSR $0079       BEQ XXC474       CMP #$2D      ;'-'       BNE XXC45A       JSR $0073       JSR LINGET       BNE XXC45AXXC474 LDA $14       ORA $15       BNE XXC480       LDA #$FF       STA $14       STA $15XXC480 RTS ;********************************XXC481 JSR XXC2CA       STA INPPTR       JSR XXC2CA       STA INPPTR+1       SEC        LDA $14       SBC INPPTR       LDA $15       SBC INPPTR+1       RTS ;********************************XXC495 LDA $5F       STA TEMP0       LDA $60       STA TEMP1       LDA $2D       STA TEMP2       LDA $2E       STA TEMP3       RTS ;********************************XXC4A6 LDA TEMP0       CMP TEMP2       BNE XXC4B0       LDA TEMP1       CMP TEMP3XXC4B0 RTS ;********************************XXC4B1 LDY XXC63F       INY        LDA (TEMP0),Y       LDY XXC643       INY        STA (TEMP0),Y       JSR XXC4A6       BNE XXC4C3       RTS ;********************************XXC4C3 INC TEMP0       BNE XXC4B1       INC TEMP1       BNE XXC4B1XXC4CB LDY XXC63F       LDA (TEMP2),Y       LDY XXC643       STA (TEMP2),Y       JSR XXC4A6       BNE XXC4DB       RTS ;********************************XXC4DB LDA TEMP2       BNE XXC4E1       DEC TEMP3XXC4E1 DEC TEMP2       JMP XXC4CB;********************************FORMAT JSR XXC452       BNE XXC4EEXXC4EB JSR XXC2C0XXC4EE JSR PRINTE       JSR XXC55A       JSR XXC2CA       BEQ XXC4FE       JSR XXC481       BCS XXC501XXC4FE JMP READY;********************************XXC501 LDX INPPTR       LDA INPPTR+1       JSR LINPRT       LDA #$20      ;' '       JSR CHROUT       LDX #$00XXC50F JSR XXC2CA       BEQ XXC4EB       CMP #OLDLIN      ;';'       BEQ XXC550       CMP #$20      ;' '       BEQ XXC522       JSR CHROUT       INX        BNE XXC50FXXC522 CPX #$07       BCS XXC52C       JSR CHROUT       INX        BNE XXC522XXC52C JSR XXC2CA       BEQ XXC4EB       CMP #$20      ;' '       BEQ XXC52CXXC535 JSR CHROUT       INX        JSR XXC2CA       BEQ XXC4EB       CMP #OLDLIN      ;';'       BNE XXC535       PHA        LDA #$20      ;' 'XXC545 CPX #$17       BCS XXC54F       JSR CHROUT       INX        BNE XXC545XXC54F PLA XXC550 JSR CHROUT       JSR XXC2CA       BEQ XXC4EB       BNE XXC550XXC55A JSR GETIN       BEQ XXC57D       CMP #$03       BNE XXC569XXC563 JSR CLRENT       JMP READY;********************************XXC569 CMP #$20      ;' '       BNE XXC57DXXC56D JSR GETIN       CMP #$20      ;' '       BEQ XXC56DXXC574 JSR GETIN       BEQ XXC574       CMP #$03       BEQ XXC563XXC57D RTS ;********************************; PRINT MESSAGE TO SCREEN; REG X CONTAINS INDEX INTO; MESSAGE TABLE;********************************PRTXT  STX INDEX ;$C57EPRTNEX LDX INDEX ;$C581       LDA MSGSTR,X       PHP        AND #$7F       JSR CHROUT       INC INDEX       PLP        BPL PRTNEX       RTS ;********************************; PRINT 'FILE ERROR';********************************XXC594 JSR CLRCHN       LDA #$08       JSR CLOSE       ;LDX #$4D      ;'M'       LDX #MSGERR-MSGSTR ;$4D	          JSR PRTXT       JMP READY;********************************; COMMANDS; AUTO; CHANGE ; CPUT; DELETE; FIND; FORMAT; GET; KILL; NUMBER; PUT;********************************CMDTAB .BYTE 'AUT' ;$C5A4       .BYTE $CF ;'O'+$80       .BYTE 'CHANG'       .BYTE $C5 ;'E'+$80       .BYTE 'CPU'       .BYTE $D4 ;'T'+$80       .BYTE 'DELET'       .BYTE $C5 ;'E'+$80       .BYTE 'FIN'       .BYTE $C4 ;'D'+$80       .BYTE 'FORMA'       .BYTE $D4 ;'T'+$80       .BYTE 'GE'       .BYTE $D4 ;'T'+$80       .BYTE 'KIL'       .BYTE $CC ;'L'+$80       .BYTE 'NUMBE'       .BYTE $D2 ;'R'+$80       .BYTE 'PU'       .BYTE $D4 ;'T'+$80;**************************************       .BYTE $00;**************************************; VECTOR TABLE - ADDRESS - 1;**************************************; AUTO;VECTOR .BYTE $91 ;XXC5D3;XXC5D4 .BYTE $C0 ;XXC3D4VECTOR  .WORD AUTO-1; CHANGE       ;.BYTE $3F       ;.BYTE $C3        .WORD CHANGE-1; CPUT       ;.BYTE $A6       ;.BYTE $C1       .WORD CPUT-1; DELETE       ;.BYTE $DD       ;.BYTE $C2       .WORD DELETE-1; FIND       ;.BYTE $4F       ;.BYTE $C3       .WORD FIND-1; FORMAT       ;.BYTE $E5       ;.BYTE $C4       .WORD FORMAT-1; GET       ;.BYTE $43       ;.BYTE $C1       .WORD GET-1; KILL       ;.BYTE $0D       ;.BYTE $C0       .WORD KILL-1; NUMBER       ;.BYTE $E6       ;.BYTE $C0       .WORD NUMBER-1; PUT       ;.BYTE $A9       ;.BYTE $C1       .WORD PUT-1;**************************************; MESSAGE TABLE;**************************************   MSGSTR .BYTE $0D ;$C5E7       .BYTE $0D       .BYTE '      COMMODORE 64 EDITOR V072982'       .BYTE $0D       .BYTE '(C) 1982 BY COMMODORE BUSINESS MACHINES'       .BYTE $0D       .BYTE $8D ; $0D WITH BIT 8 SETMSGERR .BYTE $0D       .BYTE 'FILE ERRO'       .BYTE $D2 ; $52 (R) WITH BIT 8 SET;**************************************   XXC63F .BYTE $00 ;XXC63FXXC640 .BYTE $00 ;XXC640XXC641 .BYTE $00 ;XXC641XXC642 .BYTE $00 ;XXC642XXC643 .BYTE $00 ;XXC643XXC644 .BYTE $00 ;XXC644INDEX .BYTE $00 ;$C645       .BYTE 'W,S,';********************************.END